<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­´å²å¹´ä»£æš—è¨˜ï¼šä¾ãƒãƒˆãƒ« & ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</title>
    <style>
        body { font-family: 'Hiragino Kaku Gothic ProN', sans-serif; text-align: center; background: #2c3e50; color: white; margin: 0; overflow: hidden; }
        .screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; width: 100vw; position: absolute; top: 0; left: 0; transition: 0.5s; }
        .hidden { display: none !important; }
        
        button { padding: 15px 30px; font-size: 20px; margin: 10px; cursor: pointer; border-radius: 10px; border: none; background: #e67e22; color: white; transition: 0.2s; }
        button:active { transform: scale(0.9); }
        
        /* ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #fc-card { width: 80%; height: 50vh; background: white; color: #333; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 10px 20px rgba(0,0,0,0.5); padding: 20px; position: relative; cursor: pointer; }
        #fc-main-text { font-size: 80px; font-weight: bold; }
        #fc-sub-text { font-size: 24px; color: #666; margin-top: 20px; }
        #fc-hint-text { font-size: 28px; color: #d35400; margin-top: 20px; font-weight: bold; }
        .fc-info { position: absolute; bottom: 20px; color: #999; font-size: 14px; }

        /* ã‚¯ã‚¤ã‚ºç”»é¢ç”¨ */
        #enemy-hp-bar { width: 200px; height: 20px; background: #555; border: 2px solid white; margin-bottom: 20px; }
        #enemy-hp { width: 100%; height: 100%; background: #e74c3c; transition: 0.3s; }
        #question { font-size: 24px; margin: 20px; }
        .choices { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 90%; }
    </style>
</head>
<body>

    <div id="mode-screen" class="screen">
        <h1>æ­´å²å¹´ä»£ æš—è¨˜ä¿®è¡Œ</h1>
        <button onclick="selectMode('battle')">âš”ï¸ ä¾ãƒãƒˆãƒ«ï¼ˆå¯¾æˆ¦ï¼‰</button>
        <button onclick="selectMode('flash')">ğŸ´ ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</button>
    </div>

    <div id="era-screen" class="screen hidden">
        <h2 id="era-title">æ™‚ä»£ã‚’é¸ã¼ã†</h2>
        <div id="era-buttons">
            <button onclick="selectEra('å¤ä»£')">å¤ä»£</button>
            <button onclick="selectEra('å¹³å®‰')">å¹³å®‰</button>
            <button onclick="selectEra('éŒå€‰')">éŒå€‰</button>
            <button onclick="selectEra('å®¤ç”º')">å®¤ç”º</button>
            <button onclick="selectEra('æ±Ÿæˆ¸')">æ±Ÿæˆ¸</button>
            <button onclick="selectEra('è¿‘ä»£')">è¿‘ä»£</button>
            <button onclick="selectEra('all')">å…¨æ™‚ä»£</button>
        </div>
        <button style="background:#7f8c8d" onclick="location.reload()">æˆ»ã‚‹</button>
    </div>

    <div id="diff-screen" class="screen hidden">
        <h2>é›£æ˜“åº¦ã‚’é¸æŠ</h2>
        <button onclick="startBattle(1)">åˆç´š</button>
        <button onclick="startBattle(2)">ä¸­ç´š</button>
        <button onclick="startBattle(3)">ä¸Šç´š</button>
    </div>

    <div id="battle-screen" class="screen hidden">
        <div id="enemy-hp-bar"><div id="enemy-hp"></div></div>
        <div id="question"></div>
        <div class="choices" id="choices"></div>
    </div>

    <div id="flash-screen" class="screen hidden">
        <div id="fc-progress" style="margin-bottom:10px;"></div>
        <div id="fc-card" onclick="nextFlashStep()">
            <div id="fc-main-text"></div>
            <div id="fc-hint-text" class="hidden"></div>
            <div id="fc-sub-text" class="hidden"></div>
            <div class="fc-info">ã‚¿ãƒƒãƒ—ã—ã¦é€²ã‚€</div>
        </div>
        <button style="margin-top:30px; background:#7f8c8d" onclick="location.reload()">çµ‚äº†ã™ã‚‹</button>
    </div>

    <script src="questions.js"></script>
    <script>
        let mode = "";
        let selectedEra = "";
        let quizList = [];
        let currentIdx = 0;
        let fcStep = 0; // 0:å¹´å·, 1:ã‚´ãƒ­, 2:å‡ºæ¥äº‹

        // éŸ³å£°ã®è¨­å®š
        const seOk = new Audio('ok.mp3');
        const seSlash = new Audio('slash.mp3');
        const seDamage = new Audio('damage.mp3');

        function selectMode(m) {
            seOk.play();
            mode = m;
            document.getElementById('mode-screen').classList.add('hidden');
            document.getElementById('era-screen').classList.remove('hidden');
            if(mode === 'flash') document.getElementById('era-title').innerText = "ç·´ç¿’ã™ã‚‹æ™‚ä»£ã‚’é¸ã¼ã†";
        }

        function selectEra(era) {
            seOk.play();
            selectedEra = era;
            if (mode === 'battle') {
                document.getElementById('era-screen').classList.add('hidden');
                document.getElementById('diff-screen').classList.remove('hidden');
            } else {
                startFlash();
            }
        }

        // --- ãƒãƒˆãƒ«ãƒ­ã‚¸ãƒƒã‚¯ ---
        function startBattle(diff) {
            seOk.play();
            document.getElementById('diff-screen').classList.add('hidden');
            document.getElementById('battle-screen').classList.remove('hidden');
            
            quizList = masterData.filter(q => (selectedEra === 'all' || q.era === selectedEra) && (selectedEra === 'all' ? true : q.d === diff));
            if(quizList.length === 0) quizList = masterData.filter(q => q.era === selectedEra);
            quizList = quizList.sort(() => Math.random() - 0.5).slice(0, 10);
            
            currentIdx = 0;
            showQuestion();
        }

        function showQuestion() {
            const q = quizList[currentIdx];
            document.getElementById('question').innerText = q.e;
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = "";
            
            let answers = [q.y];
            while(answers.length < 4) {
                let dummy = masterData[Math.floor(Math.random()*masterData.length)].y;
                if(!answers.includes(dummy)) answers.push(dummy);
            }
            answers.sort(() => Math.random() - 0.5);
            
            answers.forEach(a => {
                const btn = document.createElement('button');
                btn.innerText = a;
                btn.onclick = () => checkAnswer(a === q.y);
                choicesDiv.appendChild(btn);
            });
            document.getElementById('enemy-hp').style.width = ((10 - currentIdx) / 10 * 100) + "%";
        }

        function checkAnswer(isCorrect) {
            if(isCorrect) {
                seSlash.play();
                currentIdx++;
                if(currentIdx < quizList.length) {
                    showQuestion();
                } else {
                    alert("å®Œå…¨å‹åˆ©ï¼");
                    location.reload();
                }
            } else {
                seDamage.play();
                alert("ç„¡å¿µï¼ç­”ãˆã¯ " + quizList[currentIdx].y + " å¹´ã§ã—ãŸã€‚");
            }
        }

        // --- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ ---
        function startFlash() {
            document.getElementById('era-screen').classList.add('hidden');
            document.getElementById('flash-screen').classList.remove('hidden');
            
            quizList = masterData.filter(q => (selectedEra === 'all' || q.era === selectedEra)).sort(() => Math.random() - 0.5);
            currentIdx = 0;
            showFlashCard();
        }

        function showFlashCard() {
            fcStep = 0;
            const q = quizList[currentIdx];
            document.getElementById('fc-progress').innerText = `${currentIdx + 1} / ${quizList.length} æšç›®`;
            document.getElementById('fc-main-text').innerText = q.y;
            document.getElementById('fc-hint-text').innerText = q.h;
            document.getElementById('fc-sub-text').innerText = q.e;
            
            document.getElementById('fc-hint-text').classList.add('hidden');
            document.getElementById('fc-sub-text').classList.add('hidden');
        }

        function nextFlashStep() {
            fcStep++;
            if (fcStep === 1) {
                // ã‚´ãƒ­ã‚’è¡¨ç¤º
                document.getElementById('fc-hint-text').classList.remove('hidden');
                seOk.play();
            } else if (fcStep === 2) {
                // å‡ºæ¥äº‹ã‚’è¡¨ç¤º
                document.getElementById('fc-sub-text').classList.remove('hidden');
                seSlash.play();
            } else {
                // æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã¸
                currentIdx++;
                if (currentIdx < quizList.length) {
                    showFlashCard();
                } else {
                    alert("ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã‚’çµ‚äº†ã—ã¾ã—ãŸï¼");
                    location.reload();
                }
            }
        }
    </script>
</body>
</html>
